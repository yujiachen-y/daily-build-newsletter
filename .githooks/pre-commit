#!/usr/bin/env bash
set -euo pipefail

ROOT=$(git rev-parse --show-toplevel)
MODULE="$ROOT/modules/article-harvest"

if [ ! -d "$MODULE" ]; then
  echo "article-harvest not found; skipping hooks"
  exit 0
fi

VENV="$MODULE/.venv"
if [ -d "$VENV" ]; then
  # shellcheck disable=SC1090
  source "$VENV/bin/activate"
fi

cd "$MODULE"

ruff check src/article_harvest tests
pytest --cov=article_harvest --cov-report=term-missing --cov-fail-under=80 tests
