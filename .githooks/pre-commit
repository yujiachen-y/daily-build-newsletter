#!/usr/bin/env bash
set -euo pipefail

ROOT=$(git rev-parse --show-toplevel)
MODULE="$ROOT/modules/article-ingest"

if [ ! -d "$MODULE" ]; then
  echo "article-ingest removed; skipping article-ingest hooks"
  exit 0
fi

VENV="$MODULE/.venv"
if [ -d "$VENV" ]; then
  # shellcheck disable=SC1090
  source "$VENV/bin/activate"
fi

cd "$MODULE"

ruff check src/article_ingest tests
python scripts/lint_limits.py
pytest --cov=article_ingest --cov-report=term-missing --cov-fail-under=80 tests
